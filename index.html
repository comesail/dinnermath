<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DinnerMath — Slice Calculator</title>
<meta name="description" content="See how many pieces your pan makes. Smart cuts for brownies, bars, sheet cake, lasagna, and round pies/cakes — or enter a target number of pieces.">

<style>
  :root{
    --ink:#1f1f21; --muted:#6e7176; --line:#e5e7eb; --bg:#f8f9fa; --card:#ffffff; --shadow:0 10px 20px rgba(0,0,0,.06);
    --accent:#111827;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:1160px;margin:40px auto 96px;padding:0 20px}
  h1{font-size:38px;margin:0 0 8px;letter-spacing:-0.01em;text-align:center}
  .lede{color:var(--muted);font-size:16px;margin:0 0 20px;text-align:center}

  .tiles{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;align-items:start}
  @media(max-width:980px){.tiles{grid-template-columns:1fr}}

  .tile{background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;min-height:520px}
  .tile-body{padding:16px 16px 20px;display:flex;flex-direction:column;gap:12px}
  .section-label{font-size:12px;text-transform:uppercase;letter-spacing:.1em;color:var(--muted);font-weight:700}
  .hint{font-size:12px;color:var(--muted)}

  .step-head{display:grid;grid-template-columns:120px 1fr;column-gap:10px;align-items:end;margin-bottom:6px}
  .step-label{font-weight:800;font-size:12px;letter-spacing:.18em;text-transform:uppercase;color:#6b7280;line-height:1}
  .step-num{font-weight:800;color:#111827;font-size:137px;line-height:1;transform:translateY(6px)}
  .step-q{display:flex;flex-direction:column;gap:2px;margin:0;align-self:end;line-height:1.05}
  .step-q span{display:block;font-weight:800;font-size:28px;letter-spacing:.06em;text-transform:uppercase;color:#111827}

  .choice-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  @media(max-width:520px){.choice-grid{grid-template-columns:1fr}}
  .choice{position:relative;border-radius:14px;overflow:hidden;border:1px solid var(--line);cursor:pointer;min-height:160px;box-shadow:0 6px 14px rgba(0,0,0,.04);background:#eef2f7}
  .choice .title{position:absolute;left:50%;bottom:16px;transform:translateX(-50%);background:rgba(255,255,255,.9);border:1px solid var(--line);border-radius:12px;padding:6px 12px;font-weight:800}
  .choice .art{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
  .choice.selected{outline:3px solid #aeb3bb}

  .pill, input[type="number"], button.pill{
    border:1px solid var(--line);border-radius:12px;padding:12px 14px;font-size:15px;background:#fff;outline:none;
    transition:box-shadow .15s ease, transform .03s ease, border-color .15s ease; line-height:1.2; color:var(--ink);
  }
  .pill{display:inline-flex;align-items:center;justify-content:center;cursor:pointer;margin-right:8px;margin-bottom:8px;user-select:none}
  .pill:hover{background:#f3f4f6}
  .pill.active{border-color:#b9bcc2;box-shadow:0 0 0 3px rgba(0,0,0,0.04)}

  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media(max-width:760px){.row{grid-template-columns:1fr}}

  .result-box{border:1px solid var(--line);border-radius:14px;padding:16px;background:#fff}
  .big{font-size:30px;font-weight:800;letter-spacing:-0.01em}
  .micro{font-size:14px;color:var(--muted)}

  .grid-mini{display:grid;gap:3px;margin-top:12px}
  .cell{background:#e9ecf2;border:1px solid var(--line);height:22px;border-radius:6px}
  .cell.edge{background:#dfe6f0}
  .legend{font-size:12px;color:#6b7280;margin-top:8px}

  .list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
  .option{border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;cursor:pointer}
  .option:hover{background:#f3f4f6;transform:translateY(-1px)}
  .option.recommended{border-color:#b9bcc2}
  .option .title{font-weight:700;margin-bottom:4px;font-size:15px;letter-spacing:-0.01em}
  .option .meta{font-size:14px;color:var(--muted)}

  .stack{display:grid;grid-template-columns:1fr;gap:18px;margin-top:18px}

  .finder .btn-primary{display:block;text-align:center;border-radius:12px;padding:12px 14px;border:1px solid var(--line);background:#2e2f33;color:#fff;font-weight:600;text-decoration:none}
  .finder .alt-links{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
  .finder .alt-links a{font-size:14px;text-decoration:none;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:8px 10px;background:#fff}

  .footer{font-size:12px;color:var(--muted);margin-top:28px;line-height:1.5;text-align:center}

  .status-line{ margin-top:10px; font-size:0.95rem; color:#333; opacity:.85; }
  .tools-row{ margin-top:10px; display:flex; gap:10px; }
  .btn{ border:1px solid var(--line); background:#fff; border-radius:10px; padding:10px 12px; cursor:pointer; }

  #rectInputs input[type="number"],
  #roundInputs input[type="number"]{ max-width: 240px; width: 100%; }

  .pill[aria-pressed="true"]{ outline:1px solid var(--ink,#111); }

  @media print{
    body *{ visibility:hidden !important; }
    #results-card, #results-card *{ visibility:visible !important; }
    #results-card{ position:absolute; left:0; top:0; width:100%; }
    #print-footer{ display:block !important; margin-top:12px; }
  }

  /* ensure three tiles on desktop */
  @media (min-width:1024px){ .tiles{grid-template-columns:1fr 1fr 1fr} }
</style>

<!-- IMAGE MAP: load Step-1 tile images from your repo root -->
<script>
const IMG_MAP = {
  brownies:   'hero-brownies-1600w-q72.jpg',
  sheet:      'cake-dinnermath.jpg',
  roundcake:  'hero-cheesecake-1600w-q72.jpg',
  pie:        'apple_pie_dinnermath.jpg',
  cornbread:  'berry_crumble_dinnermath.jpg',
  lasagna:    'lasagna.jpg',
  roundother: 'pizza%20image.jpg' // file has a space, so %20
};
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('#tile1 .choice img.art[data-key]').forEach(img=>{
    const key = img.dataset.key;
    if (IMG_MAP[key]) img.src = IMG_MAP[key];
  });
});
</script>
</head>

<body>
<div class="wrap">
  <h1>Slice Calculator</h1>
  <p class="lede">See how many pieces your pan makes with our Slice Calculator. Whether you're baking brownies, cookie bars, sheet cake, cornbread, baked pasta, or pie, this tool shows how many slices you can cut from any pan size — or how to cut it to get the exact number you need.</p>

  <div class="tiles">
    <!-- STEP 1 -->
    <section class="tile" id="tile1">
      <div class="tile-body">
        <div class="step-head">
          <div>
            <div class="step-label">STEP</div>
            <div class="step-num">1</div>
          </div>
          <div class="step-q"><span>What are you slicing?</span></div>
        </div>

        <div class="choice-grid">
          <div class="choice" data-make="brownies"    data-shape="rect"  data-noun="slices"  tabindex="0" title="brownies, blondies, cookie bars, lemon bars">
            <img class="art" data-key="brownies" alt="Brownies & bars" loading="lazy">
            <div class="title">Brownies & Bars</div>
          </div>
          <div class="choice" data-make="sheet-cake"  data-shape="rect"  data-noun="slices"  tabindex="0" title="sheet cake, party cake">
            <img class="art" data-key="sheet" alt="Sheet cake" loading="lazy">
            <div class="title">Sheet Cake</div>
          </div>
          <div class="choice" data-make="round-cake"  data-shape="round" data-noun="slices"  tabindex="0" title="round cake, cheesecake">
            <img class="art" data-key="roundcake" alt="Round cake / cheesecake" loading="lazy">
            <div class="title">Round Cake</div>
          </div>
          <div class="choice" data-make="pie"         data-shape="round" data-noun="slices"  tabindex="0" title="pie, tart, quiche">
            <img class="art" data-key="pie" alt="Pie or tart" loading="lazy">
            <div class="title">Pie / Tart</div>
          </div>
          <div class="choice" data-make="lasagna"     data-shape="rect"  data-noun="pieces"  tabindex="0" title="lasagna, baked ziti, casserole">
            <img class="art" data-key="lasagna" alt="Lasagna / baked pasta" loading="lazy">
            <div class="title">Lasagna / Baked Pasta</div>
          </div>
          <div class="choice" data-make="cornbread"   data-shape="rect"  data-noun="pieces"  tabindex="0" title="cornbread, cobbler">
            <img class="art" data-key="cornbread" alt="Cornbread or cobbler" loading="lazy">
            <div class="title">Cornbread / Cobbler</div>
          </div>
          <div class="choice" data-make="round-other" data-shape="round" data-noun="slices"  tabindex="0" title="frittata, deep-dish pizza">
            <img class="art" data-key="roundother" alt="Other round dish" loading="lazy">
            <div class="title">Other Round Dish</div>
          </div>
        </div>

        <p id="status-make" class="status-line">Selected: —</p>
      </div>
    </section>

    <!-- STEP 2 -->
    <section class="tile" id="tile2">
      <div class="tile-body">
        <div class="step-head">
          <div>
            <div class="step-label">STEP</div>
            <div class="step-num">2</div>
          </div>
          <div class="step-q"><span>What is the shape and size of your pan?</span></div>
        </div>

        <div class="pill" id="shape-rect"  aria-pressed="true">Rectangle / Square</div>
        <div class="pill" id="shape-round" aria-pressed="false">Round</div>

        <div>
          <button class="pill" data-preset="8x8">8 x 8 in</button>
          <button class="pill" data-preset="9x13">9 x 13 in</button>
          <button class="pill" data-preset="half">Half sheet 13 x 18 in</button>
          <button class="pill" data-preset="full">Full sheet 18 x 26 in</button>
          <button class="pill" data-preset="r9">Round 9 in</button>
          <button class="pill" data-preset="r10">Round 10 in</button>
        </div>

        <div class="hint">Do not see your size? Enter it below.</div>
        <p class="hint" id="rect-order-hint">Long side first, short side second.</p>

        <div class="row" id="rectInputs">
          <div>
            <div class="section-label">LENGTH (IN) — enter the LONG side</div>
            <input id="panL" type="number" step="0.1" min="1" value="" placeholder="e.g., 13">
          </div>
          <div>
            <div class="section-label">WIDTH (IN) — enter the SHORT side</div>
            <input id="panW" type="number" step="0.1" min="1" value="" placeholder="e.g., 9">
          </div>
        </div>

        <div class="row" id="roundInputs" style="display:none">
          <div>
            <div class="section-label">Diameter (in)</div>
            <input id="panD" type="number" step="0.1" min="4" value="">
          </div>
        </div>

        <p id="status-pan" class="status-line">Selected pan: —</p>
      </div>
    </section>

    <!-- STEP 3 -->
    <section class="tile" id="tile3">
      <div class="tile-body">
        <div class="step-head">
          <div>
            <div class="step-label">STEP</div>
            <div class="step-num">3</div>
          </div>
          <div class="step-q"><span>Your</span><span>Cutting</span><span>Guide</span></div>
        </div>

        <div class="result-box" id="results-card" aria-live="polite">
          <div class="big"   id="bigTotal">0 slices</div>
          <div class="micro" id="bigMeta">about 0 x 0 in each (0 x 0 cut)</div>
          <div id="round-ruler"></div>
          <div class="grid-mini" id="miniGrid"></div>
          <div class="legend" id="legend"  style="display:none"></div>
          <div class="legend" id="legend2" style="display:block">You do not need a ruler. Aim for about this size; edge pieces can be a little smaller.</div>
          <div class="tools-row">
            <button id="btn-print" class="btn">Print cut guide</button>
          </div>
          <div id="print-footer" class="legend" style="display:none">
            Thank you for using DinnerMath’s Slice Calculator.
            Estimates only—confirm your pan’s interior size and cut spacing.
            © 2025 DinnerMath.
          </div>
        </div>

        <div class="list" id="optionsList"></div>

        <div class="row" style="margin-top:10px">
          <div>
            <div class="section-label">How many pieces do you want? (optional)</div>
            <input id="targetN" type="number" min="1" step="1" placeholder="for example 24">
          </div>
          <div style="display:flex;align-items:flex-end">
            <button class="pill" id="applyTarget">Show closest cuts</button>
          </div>
        </div>

        <div class="list" id="revList"></div>

        <div class="stack">
          <div class="finder">
            <div class="section-label">Find near me</div>
            <a class="btn-primary" target="_blank" href="https://www.google.com/maps/search/bakeries+near+me">Find bakeries</a>
            <div class="alt-links">
              <a target="_blank" href="https://www.google.com/maps/search/grocery+stores+near+me">Grocery stores</a>
              <a target="_blank" href="https://www.google.com/maps/search/bakeware+and+pans+near+me">Bakeware &amp; pans</a>
              <a target="_blank" href="https://www.walmart.com/search?q=bakeware+pan">Walmart</a>
              <a target="_blank" href="https://www.amazon.com/s?k=bakeware+pan">Amazon</a>
            </div>
          </div>
        </div>

        <div class="footer">
          Estimates only; confirm with your retailer or recipe. © 2025 DinnerMath. All rights reserved.
        </div>
      </div>
    </section>
  </div>
</div>

<script>
(function(){
  // ---------- formatting helpers ----------
  const byId = (id)=>document.getElementById(id);
  const $panL = byId('panL'), $panW = byId('panW'), $panD = byId('panD');
  const $mini = byId('miniGrid'), $legend = byId('legend'), $bigTotal = byId('bigTotal'),
        $bigMeta = byId('bigMeta'), $list = byId('optionsList'), $revList = byId('revList'),
        $target = byId('targetN'), $applyTarget = byId('applyTarget');

  function fmt(x){ return (Math.round(x*100)/100).toString().replace(/\.0+$/,'').replace(/(\.\d*[1-9])0+$/,'$1'); }

  function fmtFractionHybrid(x){
    if(!isFinite(x)) return '0';
    const neg = x<0; x=Math.abs(x);
    const labels = {'0':'', '0.25':'1/4','0.3333':'1/3','0.5':'1/2','0.6667':'2/3','0.75':'3/4','1':'1'};
    let whole=Math.floor(x), frac=x-whole;
    const choices=[0,0.25,1/3,0.5,2/3,0.75,1];
    let best=0, err=1e9;
    for(const v of choices){
      const bias=(v===1/3||v===2/3)?-0.005:0;
      const e=Math.abs(frac-v)+bias;
      if(e<err){best=v;err=e;}
    }
    if(best===1){whole+=1;best=0;}
    const t=labels[String(best)]||'', sign=neg?'-':'';
    if(whole===0 && !t) return '0';
    return (t?(sign+(whole?whole+' ':'')+t):(sign+String(whole))).trim();
  }

  function fmtFractionEighth(x){
    if(!isFinite(x)) return '0';
    const neg = x<0; x=Math.abs(x);
    let whole=Math.floor(x), eighths=Math.round((x-whole)*8);
    if(eighths===8){whole++;eighths=0;}
    const map={0:'',1:'1/8',2:'1/4',3:'3/8',4:'1/2',5:'5/8',6:'3/4',7:'7/8'};
    const t=map[eighths]||'', sign=neg?'-':'';
    return t ? `${sign}${whole ? whole+' ' : ''}${t}`.trim() : `${sign}${whole}`;
  }

  function edgeWidthAtCrust(D, pieces){ return Math.PI*D/pieces; }

  function rulerSVG(valIn){
    const span=Math.min(Math.max(Math.ceil(valIn),3),6);
    const ppi=96, W=span*ppi, H=48;
    let out=`<svg class="ruler" width="${W}" height="${H}" viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg">`;
    out+=`<rect x="0" y="0" width="${W}" height="${H}" fill="#fff" stroke="#e5e7eb"/>`;
    for(let i=0;i<=span*8;i++){
      const x=i*(ppi/8), tall=(i%8===0), mid=(i%4===0), h=tall?24:(mid?16:10);
      out+=`<line x1="${x}" y1="0" x2="${x}" y2="${h}" stroke="#111" stroke-width="1"/>`;
      if(tall){ out += `<text x="${x+2}" y="38" font-size="11" fill="#333">${(i/8).toString().replace(/\.0$/,'')}"</text>`; }
    }
    const mx=Math.max(0,Math.min(valIn,span))*ppi;
    out+=`<polygon points="${mx},28 ${mx-6},44 ${mx+6},44" fill="#ff6b00"/>`;
    out+='</svg>';
    return out;
  }

  // ---------- state ----------
  let make=null, isRound=false, presetRect=null, presetRound=null;
  let currentNoun='slices';
  function setNoun(n){ currentNoun=(n==='pieces'||n==='slices')?n:'slices'; }

  function setRound(on){
    isRound=on;
    byId('roundInputs').style.display = on ? '' : 'none';
    byId('rectInputs').style.display  = on ? 'none' : '';
  }

  function clear(el){ el.innerHTML=''; }

  function makeGrid(rows, cols){
    clear($mini);
    if(rows<=0||cols<=0){ $legend.style.display='none'; return; }
    $mini.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const d=document.createElement('div');
        d.className='cell' + ((r===0||c===0||r===rows-1||c===cols-1)?' edge':'');
        $mini.appendChild(d);
      }
    }
    $legend.style.display='';
    $legend.textContent=`${rows} rows × ${cols} columns`;
  }

  // ---------- candidates ----------
  function cutOptionsRect(L,W){
    const out=[];
    for(let rows=1; rows<=20; rows++){
      for(let cols=1; cols<=20; cols++){
        const pieceL=L/cols, pieceW=W/rows;
        const minSide=Math.min(pieceL,pieceW), maxSide=Math.max(pieceL,pieceW);
        if(minSide>=1 && maxSide<=5.5){
          out.push({rows,cols,pieces:rows*cols,pieceL,pieceW,aspect:(maxSide/minSide)});
        }
      }
    }
    // rank: size near ~2", squareness, 24-ish pieces
    out.sort((a,b)=>{
      const score=o=>{
        const s1=Math.abs(Math.max(o.pieceL,o.pieceW)-2.0)+Math.abs(Math.min(o.pieceL,o.pieceW)-2.0);
        const s2=Math.abs(o.aspect-1);
        const s3=Math.abs(o.pieces-24)/24;
        return s1*2 + s2*1.5 + s3*0.8;
      };
      return score(a)-score(b);
    });
    // de-dupe by pieces
    const seen=new Set(), picked=[];
    for(const o of out){ if(!seen.has(o.pieces)){ seen.add(o.pieces); picked.push(o); } if(picked.length>=30) break; }
    return picked;
  }

  function cutOptionsRound(D){
    const out=[];
    [6,8,10,12,14,16].forEach(p=> out.push({pieces:p}));
    out.sort((a,b)=>Math.abs(a.pieces-12)-Math.abs(b.pieces-12));
    const seen=new Set(), picked=[];
    for(const o of out){ if(!seen.has(o.pieces)){ seen.add(o.pieces); picked.push(o);} if(picked.length>=12) break; }
    return picked;
  }

  // ---------- paint ----------
  function paintSummary(pieces, meta){
    $bigTotal.textContent = `${pieces?pieces:0} ${currentNoun}`;
    $bigMeta.textContent  = meta || 'about 0 x 0 in each (0 x 0 cut)';
  }

  function paintOptionsRect(L,W,opts){
    clear($list);
    makeGrid(0,0);
    const rr=byId('round-ruler'); if(rr) rr.innerHTML='';

    if(!opts.length){ paintSummary(0,'Enter a pan size or choose a preset.'); return; }

    const best=opts[0];
    makeGrid(best.rows,best.cols);
    paintSummary(best.pieces, `about ${fmtFractionHybrid(Math.min(best.pieceL,best.pieceW))} x ${fmtFractionHybrid(Math.max(best.pieceL,best.pieceW))} in each (${best.rows} x ${best.cols} cut)`);

    opts.slice(0,3).forEach((o,i)=>{
      const li=document.createElement('div');
      li.className='option' + (i===0?' recommended':'');
      li.innerHTML=`<div class="title">${o.pieces} ${currentNoun}</div>
        <div class="meta">about ${fmtFractionHybrid(Math.min(o.pieceL,o.pieceW))} x ${fmtFractionHybrid(Math.max(o.pieceL,o.pieceW))} in each (${o.rows} x ${o.cols} cut)</div>`;
      li.addEventListener('click', ()=>{
        makeGrid(o.rows,o.cols);
        paintSummary(o.pieces, `about ${fmtFractionHybrid(Math.min(o.pieceL,o.pieceW))} x ${fmtFractionHybrid(Math.max(o.pieceL,o.pieceW))} in each (${o.rows} x ${o.cols} cut)`);
        if(rr) rr.innerHTML='';
      });
      $list.appendChild(li);
    });
  }

  function paintOptionsRound(D,opts){
    clear($list);
    makeGrid(0,0);

    // prefer 8/10/12 visually
    const want=[8,10,12], map=new Map(opts.map(o=>[o.pieces,o]));
    const ordered=[...want.map(n=>map.get(n)).filter(Boolean), ...opts.filter(o=>!want.includes(o.pieces))];

    const best=ordered[0]||opts[0];
    const edge=edgeWidthAtCrust(D,best.pieces);
    paintSummary(`Cut into ${best.pieces} ${currentNoun}`, `Readable label: ${fmtFractionHybrid(edge)} in`);
    const rr=byId('round-ruler'); if(rr) rr.innerHTML=rulerSVG(edge);

    ordered.slice(0,3).forEach((o,i)=>{
      const li=document.createElement('div');
      li.className='option' + (i===0?' recommended':'');
      li.innerHTML=`<div class="title">${o.pieces} ${currentNoun}</div>
        <div class="meta">edge width: ${fmtFractionEighth(edgeWidthAtCrust(D,o.pieces))} in (round ${fmt(D)} in pan)</div>`;
      li.addEventListener('click', ()=>{
        const e=edgeWidthAtCrust(D,o.pieces);
        paintSummary(`Cut into ${o.pieces} ${currentNoun}`, `Readable label: ${fmtFractionHybrid(e)} in`);
        if(rr) rr.innerHTML=rulerSVG(e);
      });
      $list.appendChild(li);
    });
  }

  function labelForPanRect(L,W){ return `${Math.round(Math.max(L,W))} x ${Math.round(Math.min(L,W))} in`; }
  function labelForPanRound(D){ return `Round ${Math.round(D)} in`; }

  function afterPanUpdate(){
    const el=byId('status-pan'); if(!el) return;
    if(isRound){
      const typedD=parseFloat(($panD||{}).value||'0');
      const D=typedD || (presetRound ? presetRound.D : 0);
      el.textContent = D ? `Selected pan: ${labelForPanRound(D)}` : 'Selected pan: —';
    }else{
      const typedL=parseFloat(($panL||{}).value||'0');
      const typedW=parseFloat(($panW||{}).value||'0');
      const L=(typedL&&typedW)?typedL:(presetRect?presetRect.L:0);
      const W=(typedL&&typedW)?typedW:(presetRect?presetRect.W:0);
      el.textContent = (L&&W) ? (typedL&&typedW ? `Selected pan: ${fmt(typedL)} x ${fmt(typedW)} in` : `Selected pan: ${labelForPanRect(L,W)}`) : 'Selected pan: —';
    }
  }

  // ---------- reverse (target) ----------
  function showClosestCuts(target){
    $revList.innerHTML='';
    if(!target || target<1) return;

    if(isRound){
      const typedD=parseFloat(($panD||{}).value||'0');
      const D=typedD || (presetRound ? presetRound.D : 0);
      if(!D) return;
      const opts=cutOptionsRound(D);
      const scored=opts.map(o=>({o,diff:Math.abs(o.pieces-target)})).sort((a,b)=>a.diff-b.diff).slice(0,3);
      scored.forEach(s=>{
        const item=document.createElement('div');
        item.className='option';
        item.innerHTML=`<div class="title">Closest: ${s.o.pieces} ${currentNoun}</div>`;
        $revList.appendChild(item);
      });
    }else{
      const typedL=parseFloat(($panL||{}).value||'0');
      const typedW=parseFloat(($panW||{}).value||'0');
      const L=(typedL&&typedW)?typedL:(presetRect?presetRect.L:0);
      const W=(typedL&&typedW)?typedW:(presetRect?presetRect.W:0);
      if(!L||!W) return;
      const opts=cutOptionsRect(L,W);
      const scored=opts.map(o=>({o,diff:Math.abs(o.pieces-target)})).sort((a,b)=>a.diff-b.diff).slice(0,3);
      scored.forEach(s=>{
        const item=document.createElement('div');
        item.className='option';
        item.innerHTML=`<div class="title">${s.diff===0?'Exact':'Closest'}: ${s.o.pieces} ${currentNoun} — ${fmtFractionHybrid(Math.min(s.o.pieceL,s.o.pieceW))} x ${fmtFractionHybrid(Math.max(s.o.pieceL,s.o.pieceW))} in</div>`;
        $revList.appendChild(item);
      });
    }
  }

  // ---------- wire up ----------
  document.querySelectorAll('#tile1 .choice').forEach(el=>{
    el.addEventListener('click', ()=>{
      const isRoundOn = el.dataset.shape === 'round';
      if(el.dataset.make) make = el.dataset.make;
      setNoun(el.dataset.noun);
      setRound(isRoundOn);
      const t = el.querySelector('.title')?.textContent?.trim() || '—';
      byId('status-make').textContent = `Selected: ${t}`;
      updateFromInputs();
      afterPanUpdate();
    });
    el.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); el.click(); }});
  });

  byId('shape-rect').addEventListener('click', ()=>{
    setRound(false);
    byId('shape-rect').setAttribute('aria-pressed','true');
    byId('shape-round').setAttribute('aria-pressed','false');
    try{$panD.value='';}catch(_){}
    updateFromInputs(); afterPanUpdate();
  });
  byId('shape-round').addEventListener('click', ()=>{
    setRound(true);
    byId('shape-round').setAttribute('aria-pressed','true');
    byId('shape-rect').setAttribute('aria-pressed','false');
    try{$panL.value='';$panW.value='';}catch(_){}
    updateFromInputs(); afterPanUpdate();
  });

  document.querySelectorAll('[data-preset]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('[data-preset]').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const p = btn.getAttribute('data-preset');
      try{$panL.value='';$panW.value='';$panD.value='';}catch(_){}

      if(p==='8x8'){  setRound(false); presetRect={L:8,W:8};       presetRound=null; byId('shape-rect').click(); }
      if(p==='9x13'){ setRound(false); presetRect={L:13,W:9};      presetRound=null; byId('shape-rect').click(); }
      if(p==='half'){ setRound(false); presetRect={L:18,W:13};     presetRound=null; byId('shape-rect').click(); }
      if(p==='full'){ setRound(false); presetRect={L:26,W:18};     presetRound=null; byId('shape-rect').click(); }
      if(p==='r9'){   setRound(true);  presetRect=null;            presetRound={D:9};  byId('shape-round').click(); }
      if(p==='r10'){  setRound(true);  presetRect=null;            presetRound={D:10}; byId('shape-round').click(); }

      updateFromInputs(); afterPanUpdate();
    });
  });

  [$panL,$panW,$panD].forEach(inp=> inp.addEventListener('input', updateFromInputs));
  $applyTarget.addEventListener('click', ()=> showClosestCuts(parseInt($target.value,10)));

  function updateFromInputs(){
    $revList.innerHTML='';
    if(isRound){
      const typedD=parseFloat($panD.value||'0');
      const D=typedD || (presetRound ? presetRound.D : 0);
      if(!D){ paintSummary(0,'Set diameter or pick a preset.'); clear($list); makeGrid(0,0); return; }
      const options=cutOptionsRound(D);
      paintOptionsRound(D, options);
      return;
    }
    const typedL=parseFloat($panL.value||'0');
    const typedW=parseFloat($panW.value||'0');
    const L=(typedL&&typedW)?typedL:(presetRect?presetRect.L:0);
    const W=(typedL&&typedW)?typedW:(presetRect?presetRect.W:0);
    if(!L||!W){ paintSummary(0,'Enter a pan size or choose a preset.'); clear($list); makeGrid(0,0); return; }
    const options=cutOptionsRect(L,W);
    paintOptionsRect(L,W,options);
  }

  // init defaults
  try{$panL.value='';$panW.value='';$panD.value='';}catch(_){}
  setRound(false);
  afterPanUpdate();

  // print
  byId('btn-print')?.addEventListener('click', ()=> window.print());
})();
</script>
</body>
</html>
